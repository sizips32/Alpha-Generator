# 알파 팩터 생성기 v2.0 사용자 가이드

## 시작하기

### 1. 첫 실행

#### 애플리케이션 시작
```bash
# 터미널에서 실행
cd alpha_factor_generator_v2
./run.sh

# 또는 직접 실행
streamlit run app.py
```

#### 웹 브라우저 접속
- 자동으로 브라우저가 열리거나
- 수동으로 `http://localhost:8501` 접속

### 2. 초기 설정

#### API 키 설정 (선택사항)
1. **설정** 페이지로 이동
2. **API 설정** 탭 선택
3. Gemini API 키 입력
4. **API 설정 저장** 클릭

> 💡 **팁**: Gemini API 키가 없어도 기본 기능은 모두 사용 가능합니다.

## 단계별 사용법

### Step 1: 데이터 준비

#### 1-1. 데이터 관리 페이지 접속
- 왼쪽 사이드바에서 **"데이터 관리"** 선택

#### 1-2. 주식 심볼 선택
```
기본 포트폴리오: AAPL, GOOGL, MSFT, AMZN, TSLA
기술주: AAPL, GOOGL, MSFT, META, NFLX, NVDA, AMD
금융주: JPM, BAC, WFC, GS, MS, C
```

- **심볼 그룹 선택**: 미리 정의된 그룹 중 선택
- **추가 심볼 입력**: 원하는 종목 추가 (예: TSLA, NVDA, AMD)

#### 1-3. 데이터 설정
- **데이터 기간**: 1y, 2y, 5y, max 중 선택 (권장: 2y)
- **데이터 간격**: 1d (일봉), 1wk (주봉), 1mo (월봉)
- **캐시 사용**: 체크 (빠른 로딩을 위해 권장)

#### 1-4. 데이터 로드
- **"📥 데이터 로드"** 버튼 클릭
- 로딩 완료 후 데이터 미리보기 확인

### Step 2: AI 팩터 추천 (선택사항)

#### 2-1. AI 팩터 추천 페이지 접속
- 사이드바에서 **"AI 팩터 추천"** 선택

#### 2-2. 투자 아이디어 입력
**직접 입력 예시:**
```
ESG 점수가 높은 기업들이 장기적으로 더 좋은 성과를 낼 것이라고 생각합니다. 
특히 환경 관련 지표와 기업 지배구조 점수를 결합한 팩터를 만들고 싶습니다.
```

**또는 파일 업로드:**
- .md 또는 .txt 파일로 상세한 투자 전략 업로드

#### 2-3. 추가 설정
- **위험 선호도**: 보수적 / 균형 / 공격적
- **시장 상황**: 현재 시장 환경 입력 (예: "고금리 환경")

#### 2-4. AI 추천 실행
- **"🚀 AI 팩터 추천 받기"** 클릭
- 추천 결과 확인:
  - 📋 분석 결과
  - 🎯 추천 피처
  - 📊 추천 수식
  - 🤖 ML 방법 추천
  - ⚠️ 위험 고려사항
  - 💡 구현 팁

### Step 3: 팩터 생성

#### 3-1. 팩터 생성 페이지 접속
- 사이드바에서 **"팩터 생성"** 선택

#### 3-2. 수식 기반 팩터 생성

**간단한 예시:**
```python
# 현재가 대비 20일 이동평균 비율
Close / SMA_20

# ROE 대비 PBR 효율성
ROE / PBR

# 변동성 조정 모멘텀
(Close - SMA_50) / ATR
```

**고급 예시:**
```python
# 랭킹 기반 팩터
rank(ROE) / len(ROE) - rank(PBR) / len(PBR)

# 롤링 통계 활용
(Close - rolling_mean(Close, 20)) / rolling_std(Close, 20)

# 로그 수익률 모멘텀
log(Close / shift(Close, 20))
```

**생성 과정:**
1. AI 추천 수식 선택 또는 직접 입력
2. 팩터 이름 입력
3. **"수식 팩터 생성"** 클릭
4. IC, ICIR 등 성과 지표 확인

#### 3-3. ML 기반 팩터 생성

**지원하는 ML 방법:**
- **Random Forest**: 피처 중요도 기반 조합
- **MLP**: 신경망 기반 잠재 팩터
- **PCA**: 주성분 분석
- **XGBoost**: 그래디언트 부스팅

**생성 과정:**
1. ML 방법 선택
2. 사용할 피처 선택 (예: Close, Volume, RSI, PBR, ROE)
3. 타겟 변수 선택 (보통 Close)
4. 팩터 이름 입력
5. **"ML 팩터 생성"** 클릭

#### 3-4. 커스텀 팩터 생성

**기술적 지표 조합:**
- 지표 선택: RSI, MACD, SMA_20 등
- 조합 방법: 가중평균, 곱셈, 비율, 차이
- 자동 수식 생성 및 팩터 생성

### Step 4: 백테스팅

#### 4-1. 백테스팅 페이지 접속
- 사이드바에서 **"백테스팅"** 선택

#### 4-2. 팩터 선택
- 생성된 팩터 중 백테스팅할 팩터 선택

#### 4-3. 백테스팅 설정

**기본 설정:**
- **리밸런싱 주기**: 월별 (권장)
- **롱숏 전략**: 체크 (권장)
- **상위 퍼센타일**: 20% (롱 포지션)
- **하위 퍼센타일**: 20% (숏 포지션)
- **거래비용**: 0.1%

**고급 설정:**
- 일별/주별 리밸런싱 (단기 전략용)
- 롱온리 전략 (숏 포지션 제외)
- 다양한 퍼센타일 비율 테스트

#### 4-4. 백테스팅 실행
- **"🚀 백테스팅 실행"** 클릭
- 결과 분석:
  - 📊 성과 지표 (수익률, 샤프비율, 최대낙폭 등)
  - 📈 성과 차트 (누적수익률, 일별수익률)
  - 벤치마크 대비 성과

### Step 5: 팩터 관리

#### 5-1. 팩터 동물원 페이지 접속
- 사이드바에서 **"팩터 동물원"** 선택

#### 5-2. 팩터 목록 관리
- 생성된 모든 팩터 한눈에 보기
- IC, ICIR 기준으로 정렬
- 팩터 성과 비교

#### 5-3. 팩터 상세 분석
- 팩터 선택 시 상세 정보 표시:
  - 📊 팩터 값 분포 히스토그램
  - 📈 팩터 시계열 차트
  - ℹ️ 팩터 메타데이터
  - 백테스팅 결과 연결

#### 5-4. 팩터 삭제
- 불필요한 팩터 삭제 기능

## 실전 활용 팁

### 좋은 팩터의 특징

#### 통계적 지표
- **IC > 0.05**: 팩터와 수익률 간 의미있는 상관관계
- **ICIR > 1.0**: 안정적인 IC 값
- **승률 > 55%**: 절반 이상의 성공률

#### 백테스팅 결과
- **샤프 비율 > 1.0**: 위험 대비 우수한 수익률
- **최대 낙폭 < 20%**: 감당 가능한 위험 수준
- **칼마 비율 > 0.5**: 낙폭 대비 양호한 수익률

### 팩터 조합 전략

#### 1. 다양성 확보
```
모멘텀 팩터 + 밸류 팩터 + 퀄리티 팩터
```

#### 2. 상관관계 확인
- 서로 다른 카테고리의 팩터 조합
- 높은 상관관계 팩터 중복 방지

#### 3. 시장 환경별 적응
- **상승장**: 모멘텀 팩터 비중 증가
- **하락장**: 밸류/퀄리티 팩터 비중 증가
- **횡보장**: 평균회귀 팩터 활용

### 리스크 관리

#### 포지션 사이징
- 단일 팩터 비중 < 30%
- 섹터 집중도 모니터링
- 시가총액 다양성 확보

#### 정기적 점검
- 월별 팩터 성과 리뷰
- 분기별 전략 재조정
- 연별 백테스팅 업데이트

## 문제 해결

### 자주 묻는 질문

#### Q1: 데이터 로드가 느려요
**A1**: 
- 캐시 사용 옵션 체크
- 심볼 개수 줄이기 (10개 이하 권장)
- 데이터 기간 단축 (1y로 시작)

#### Q2: 팩터 생성 시 오류가 발생해요
**A2**:
- 수식에 존재하지 않는 컬럼명 사용 확인
- 특수문자나 공백 제거
- 간단한 수식부터 시작 (예: Close / SMA_20)

#### Q3: AI 추천이 작동하지 않아요
**A3**:
- Gemini API 키 확인
- 인터넷 연결 상태 확인
- API 키 없이도 기본 추천 기능 사용 가능

#### Q4: 백테스팅 결과가 이상해요
**A4**:
- 충분한 데이터 기간 확보 (최소 1년)
- 거래비용 설정 확인
- 리밸런싱 주기 조정

### 오류 메시지 해결

#### "허용되지 않은 변수/함수" 오류
```python
# 잘못된 예시
Close / UNKNOWN_COLUMN

# 올바른 예시  
Close / SMA_20
```

#### "수식 결과가 모두 NaN" 오류
```python
# 문제: 0으로 나누기
Close / 0

# 해결: 안전한 나누기
Close / (SMA_20 + 1e-6)
```

#### "데이터를 로드할 수 없습니다" 오류
- 인터넷 연결 확인
- 올바른 심볼명 확인 (예: AAPL, GOOGL)
- 시장 개장 시간 확인

## 고급 활용법

### 커스텀 수식 작성

#### 복잡한 조건문
```python
# 조건부 팩터 (높은 거래량일 때만)
(Close / SMA_20) * (Volume > rolling_mean(Volume, 20))
```

#### 다중 시간대 분석
```python
# 단기/장기 모멘텀 조합
(Close / SMA_5) * 0.3 + (Close / SMA_50) * 0.7
```

#### 섹터 중립화
```python
# 섹터 내 상대적 성과
rank(ROE) / len(ROE) - 0.5
```

### 포트폴리오 최적화

#### 1. 팩터 가중치 최적화
- 백테스팅 결과 기반 가중치 조정
- 샤프 비율 최대화 목표

#### 2. 동적 리밸런싱
- 시장 변동성에 따른 주기 조정
- VIX 지수 연동 전략

#### 3. 리스크 패리티
- 각 팩터의 리스크 기여도 균등화
- 변동성 기반 포지션 조정

---

이 사용자 가이드를 통해 알파 팩터 생성기 v2.0을 효과적으로 활용하여 성공적인 퀀트 투자 전략을 개발하시기 바랍니다. 추가 질문이나 도움이 필요하시면 언제든지 문의해 주세요!

